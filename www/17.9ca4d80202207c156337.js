(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{wmmW:function(e,t,i){"use strict";i.r(t),i.d(t,"NewOfferPageModule",function(){return z});var o=i("PCNd"),n=i("ofXK"),r=i("3Pt+"),a=i("TEn/"),c=i("tyNb"),s=i("eIep"),l=i("fXoL"),b=i("Qe3P"),m=i("lJxs"),p=i("9Uo9"),g=i("AytR"),u=i("LRne"),h=i("gcOT"),f=i("tk/3");function d(e,t){1&e&&l.Kb(0,"ion-spinner",4)}function w(e,t){if(1&e){const e=l.Nb();l.Mb(0,"ion-img",5),l.Ub("click",function(){return l.fc(e),l.Wb().onPickLocation()}),l.Lb()}if(2&e){const e=l.Wb();l.bc("src",e.selectedLocationImage)}}function k(e,t){if(1&e){const e=l.Nb();l.Mb(0,"ion-button",6),l.Ub("click",function(){return l.fc(e),l.Wb().onPickLocation()}),l.Kb(1,"ion-icon",7),l.Mb(2,"ion-label"),l.jc(3,"Select Location"),l.Lb(),l.Lb()}}let P=(()=>{class e{constructor(e,t,i,o){this.modalCtrl=e,this.http=t,this.actionSheetCtrl=i,this.alertCtrl=o,this.locationPick=new l.o,this.showPreview=!1,this.isLoading=!1}ngOnInit(){}onPickLocation(){this.actionSheetCtrl.create({header:"Please Choose",buttons:[{text:"Use Current Location",handler:()=>{this.locateUser()}},{text:"Pick on Map",handler:()=>{this.openMap()}},{text:"Cancel",role:"cancel"}]}).then(e=>{e.present()})}locateUser(){h.c.isPluginAvailable("Geolocation")?(this.isLoading=!0,h.d.Geolocation.getCurrentPosition().then(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};this.createPlace(t.lat,t.lng),this.isLoading=!1}).catch(e=>{this.showErrorAlert(),this.isLoading=!1})):this.showErrorAlert()}showErrorAlert(){this.alertCtrl.create({header:"Could not fetch location",message:"Please use the map to fetch a location",buttons:["Okay"]}).then(e=>{e.present()})}openMap(){this.modalCtrl.create({component:p.a}).then(e=>{e.onDidDismiss().then(e=>{if(!e.data)return;const t={lat:e.data.lat,lng:e.data.lng};this.createPlace(t.lat,t.lng)}),e.present()})}createPlace(e,t){const i={lat:e,lng:t,address:null,staticMapImageUrl:null};this.isLoading=!0,this.getAddress(e,t).pipe(Object(s.a)(e=>(i.address=e,Object(u.a)(this.getMapImage(i.lat,i.lng,14))))).subscribe(e=>{i.staticMapImageUrl=e,this.selectedLocationImage=e,this.isLoading=!1,this.locationPick.emit(i)})}getAddress(e,t){return this.http.get(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${e},${t}&key=${g.a.googleMapsAPIKey}`).pipe(Object(m.a)(e=>!e||!e.results||e.results.length<=0?null:e.results[0].formatted_address))}getMapImage(e,t,i){return`https://maps.googleapis.com/maps/api/staticmap?center=${e},${t}&zoom=${i}&size=500x300&maptype=roadmap\n    &markers=color:red%7Clabel:PLACE%7C${e},${t}\n    &key=${g.a.googleMapsAPIKey}`}}return e.\u0275fac=function(t){return new(t||e)(l.Jb(a.Y),l.Jb(f.a),l.Jb(a.a),l.Jb(a.b))},e.\u0275cmp=l.Db({type:e,selectors:[["app-location-picker"]],inputs:{showPreview:"showPreview"},outputs:{locationPick:"locationPick"},decls:4,vars:3,consts:[[1,"picker"],["color","primary",4,"ngIf"],["role","button","class","location-image",3,"src","click",4,"ngIf"],["color","primary",3,"click",4,"ngIf"],["color","primary"],["role","button",1,"location-image",3,"src","click"],["color","primary",3,"click"],["name","map","slot","start"]],template:function(e,t){1&e&&(l.Mb(0,"div",0),l.ic(1,d,1,0,"ion-spinner",1),l.ic(2,w,1,1,"ion-img",2),l.ic(3,k,4,0,"ion-button",3),l.Lb()),2&e&&(l.zb(1),l.bc("ngIf",t.isLoading),l.zb(1),l.bc("ngIf",t.selectedLocationImage&&!t.isLoading&&t.showPreview),l.zb(1),l.bc("ngIf",!(t.selectedLocationImage&&t.showPreview||t.isLoading)))},directives:[n.k,a.K,a.t,a.g,a.s,a.z],styles:[".picker[_ngcontent-%COMP%]{width:30rem;max-width:80%;height:20rem;max-height:30vh;border:1px solid var(--ion-color-primary);margin:auto;display:flex;justify-content:center;align-items:center}.location-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}"]}),e})();const L=["filePicker"];function v(e,t){if(1&e){const e=l.Nb();l.Mb(0,"ion-img",4),l.Ub("click",function(){return l.fc(e),l.Wb().onPickImage()}),l.Lb()}if(2&e){const e=l.Wb();l.bc("src",e.selectedImage)}}function M(e,t){if(1&e){const e=l.Nb();l.Mb(0,"ion-button",5),l.Ub("click",function(){return l.fc(e),l.Wb().onPickImage()}),l.Kb(1,"ion-icon",6),l.Mb(2,"ion-label"),l.jc(3,"Take Picture"),l.Lb(),l.Lb()}}function y(e,t){if(1&e){const e=l.Nb();l.Mb(0,"input",7,8),l.Ub("change",function(t){return l.fc(e),l.Wb().onFileChosen(t)}),l.Lb()}}let I=(()=>{class e{constructor(e){this.platform=e,this.imagePick=new l.o,this.showPreview=!1,this.usePicker=!1}ngOnInit(){console.log("mobile",this.platform.is("mobile")),console.log("hybrid",this.platform.is("hybrid")),console.log("ios",this.platform.is("ios")),console.log("android",this.platform.is("android")),console.log("desktop",this.platform.is("desktop")),(this.platform.is("mobile")&&!this.platform.is("hybrid")||this.platform.is("desktop"))&&(this.usePicker=!0)}onPickImage(){h.c.isPluginAvailable("Camera")?h.d.Camera.getPhoto({quality:50,source:h.b.Prompt,correctOrientation:!0,width:600,resultType:h.a.Base64}).then(e=>{this.selectedImage=e.base64String,this.imagePick.emit(e.base64String)}).catch(e=>{this.usePicker&&this.filePickerRef.nativeElement.click(),console.log(e)}):this.filePickerRef.nativeElement.click()}onFileChosen(e){const t=e.target.files[0];if(!t)return;const i=new FileReader;i.onload=()=>{const e=i.result.toString();this.selectedImage=e,this.imagePick.emit(t),console.log(i)},i.readAsDataURL(t)}}return e.\u0275fac=function(t){return new(t||e)(l.Jb(a.bb))},e.\u0275cmp=l.Db({type:e,selectors:[["app-image-picker"]],viewQuery:function(e,t){if(1&e&&l.mc(L,1),2&e){let e;l.dc(e=l.Vb())&&(t.filePickerRef=e.first)}},inputs:{showPreview:"showPreview"},outputs:{imagePick:"imagePick"},decls:4,vars:3,consts:[[1,"picker"],["role","button","class","image",3,"src","click",4,"ngIf"],["color","primary",3,"click",4,"ngIf"],["type","file","accept","image/jpeg",3,"change",4,"ngIf"],["role","button",1,"image",3,"src","click"],["color","primary",3,"click"],["name","camera","slot","start"],["type","file","accept","image/jpeg",3,"change"],["filePicker",""]],template:function(e,t){1&e&&(l.Mb(0,"div",0),l.ic(1,v,1,1,"ion-img",1),l.ic(2,M,4,0,"ion-button",2),l.Lb(),l.ic(3,y,2,0,"input",3)),2&e&&(l.zb(1),l.bc("ngIf",t.selectedImage&&t.showPreview),l.zb(1),l.bc("ngIf",!t.selectedImage||!t.showPreview),l.zb(1),l.bc("ngIf",t.usePicker))},directives:[n.k,a.t,a.g,a.s,a.z],styles:[".picker[_ngcontent-%COMP%]{width:30rem;max-width:80%;height:20rem;max-height:30vh;border:1px solid var(--ion-color-primary);margin:auto;display:flex;justify-content:center;align-items:center}.image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}input[type=file][_ngcontent-%COMP%]{display:none}"]}),e})();function C(e,t){1&e&&(l.Mb(0,"ion-row"),l.Mb(1,"ion-col",6),l.Mb(2,"p"),l.jc(3,"Description must between 1 and 180 characters"),l.Lb(),l.Lb(),l.Lb())}const j=[{path:"",component:(()=>{class e{constructor(e,t,i){this.placesService=e,this.router=t,this.loadingCtrl=i}ngOnInit(){this.form=new r.d({title:new r.b(null,{updateOn:"blur",validators:[r.p.required]}),description:new r.b(null,{updateOn:"blur",validators:[r.p.required,r.p.maxLength(180)]}),price:new r.b(null,{updateOn:"blur",validators:[r.p.required,r.p.min(1)]}),dateFrom:new r.b(null,{updateOn:"blur",validators:[r.p.required]}),dateTo:new r.b(null,{updateOn:"blur",validators:[r.p.required]}),location:new r.b(null,{validators:[r.p.required]}),image:new r.b(null)})}onLocationPicked(e){this.form.patchValue({location:e})}onImagePicked(e){let t;if("string"==typeof e){try{t=function(e,t){t=t||"";const i=1024,o=atob(e),n=o.length,r=Math.ceil(n/i),a=new Array(r);for(var c=0;c<r;++c){const e=c*i,t=Math.min(e+i,n),r=new Array(t-e);for(let i=e,n=0;i<t;++n,++i)r[n]=o[i].charCodeAt(0);a[c]=new Uint8Array(r)}return new Blob(a,{type:t})}(e.replace("data:image/jpeg;base64",""),"image/jpeg")}catch(i){return void console.log(i)}console.log("String",t)}else console.log("File",e),t=e;this.form.patchValue({image:t}),console.log(this.form.value)}onCreateOffer(){this.form.valid&&this.form.get("image").value&&(console.log(this.form.value),this.loadingCtrl.create({message:"Creating place..."}).then(e=>{e.present(),this.placesService.uploadImage(this.form.get("image").value).pipe(Object(s.a)(e=>this.placesService.addPlace(this.form.value.title,this.form.value.description,+this.form.value.price,new Date(this.form.value.dateFrom),new Date(this.form.value.dateTo),this.form.value.location,e.imageUrl))).subscribe(()=>{e.dismiss(),this.form.reset(),this.router.navigateByUrl("/places/tabs/offers")})}))}}return e.\u0275fac=function(t){return new(t||e)(l.Jb(b.a),l.Jb(c.g),l.Jb(a.W))},e.\u0275cmp=l.Db({type:e,selectors:[["app-new-offer"]],decls:48,vars:5,consts:[["slot","start"],["defaultHref","/places/tabs/offers"],["slot","primary"],[3,"disabled","click"],["name","checkmark","slot","icon-only"],[3,"formGroup"],["size-sm","6","offset-sm","3"],["position","floating"],["type","text","autocomplete","","autocorrect","","formControlName","title"],["rows","3","formControlName","description"],[4,"ngIf"],["type","number","formControlName","price"],["size-sm","3","offset-sm","3"],["min","2019-01-01","max","2022-12-31","formControlName","dateFrom"],["size-sm","3"],["min","2019-01-02","max","2022-12-31","formControlName","dateTo"],[3,"showPreview","locationPick"],[3,"showPreview","imagePick"]],template:function(e,t){1&e&&(l.Mb(0,"ion-header"),l.Mb(1,"ion-toolbar"),l.Mb(2,"ion-buttons",0),l.Kb(3,"ion-back-button",1),l.Lb(),l.Mb(4,"ion-title"),l.jc(5,"New Offer"),l.Lb(),l.Mb(6,"ion-buttons",2),l.Mb(7,"ion-button",3),l.Ub("click",function(){return t.onCreateOffer()}),l.Kb(8,"ion-icon",4),l.Lb(),l.Lb(),l.Lb(),l.Lb(),l.Mb(9,"ion-content"),l.Mb(10,"form",5),l.Mb(11,"ion-grid"),l.Mb(12,"ion-row"),l.Mb(13,"ion-col",6),l.Mb(14,"ion-item"),l.Mb(15,"ion-label",7),l.jc(16,"Title"),l.Lb(),l.Kb(17,"ion-input",8),l.Lb(),l.Lb(),l.Lb(),l.Mb(18,"ion-row"),l.Mb(19,"ion-col",6),l.Mb(20,"ion-item"),l.Mb(21,"ion-label",7),l.jc(22,"Short Description"),l.Lb(),l.Kb(23,"ion-textarea",9),l.Lb(),l.Lb(),l.Lb(),l.ic(24,C,4,0,"ion-row",10),l.Mb(25,"ion-row"),l.Mb(26,"ion-col",6),l.Mb(27,"ion-item"),l.Mb(28,"ion-label",7),l.jc(29,"Price"),l.Lb(),l.Kb(30,"ion-input",11),l.Lb(),l.Lb(),l.Lb(),l.Mb(31,"ion-row"),l.Mb(32,"ion-col",12),l.Mb(33,"ion-item"),l.Mb(34,"ion-label",7),l.jc(35,"Available from"),l.Lb(),l.Kb(36,"ion-datetime",13),l.Lb(),l.Lb(),l.Mb(37,"ion-col",14),l.Mb(38,"ion-item"),l.Mb(39,"ion-label",7),l.jc(40,"Available to"),l.Lb(),l.Kb(41,"ion-datetime",15),l.Lb(),l.Lb(),l.Lb(),l.Mb(42,"ion-row"),l.Mb(43,"ion-col",6),l.Mb(44,"app-location-picker",16),l.Ub("locationPick",function(e){return t.onLocationPicked(e)}),l.Lb(),l.Lb(),l.Lb(),l.Mb(45,"ion-row"),l.Mb(46,"ion-col",6),l.Mb(47,"app-image-picker",17),l.Ub("imagePick",function(e){return t.onImagePicked(e)}),l.Lb(),l.Lb(),l.Lb(),l.Lb(),l.Lb(),l.Lb()),2&e&&(l.zb(7),l.bc("disabled",!t.form.valid||!t.form.get("image").value),l.zb(3),l.bc("formGroup",t.form),l.zb(14),l.bc("ngIf",!t.form.get("description").valid&&t.form.get("description").touched),l.zb(20),l.bc("showPreview",t.form.get("location").value),l.zb(3),l.bc("showPreview",t.form.get("image").value))},directives:[a.r,a.S,a.h,a.e,a.f,a.R,a.g,a.s,a.o,r.q,r.k,r.e,a.q,a.F,a.n,a.v,a.z,a.u,a.eb,r.j,r.c,a.P,n.k,a.ab,a.p,a.db,P,I],styles:[""]}),e})()}];let O=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=l.Hb({type:e}),e.\u0275inj=l.Gb({imports:[[c.i.forChild(j)],c.i]}),e})(),z=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=l.Hb({type:e}),e.\u0275inj=l.Gb({imports:[[n.b,r.n,a.U,O,o.a]]}),e})()}}]);